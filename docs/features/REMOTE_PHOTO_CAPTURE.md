# Remote Photo Capture ‚Äî –£–¥–∞–ª—ë–Ω–Ω–∞—è –§–æ—Ç–æ—Å—ä—ë–º–∫–∞

## üì∏ –û–±–∑–æ—Ä

–° –≤–µ—Ä—Å–∏–∏ **v7.1.0** ChildWatch –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **—Ä–µ–∞–ª—å–Ω—É—é —É–¥–∞–ª—ë–Ω–Ω—É—é —Ñ–æ—Ç–æ—Å—ä—ë–º–∫—É** —á–µ—Ä–µ–∑ Camera2 API –≤–º–µ—Å—Ç–æ placeholder –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.

## üéØ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –ø–æ—Ç–æ–∫

1. **–†–æ–¥–∏—Ç–µ–ª—å** –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É `ACTION_TAKE_PHOTO` —á–µ—Ä–µ–∑ WebSocket/REST
2. **MonitorService** –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ —Ä–µ–±—ë–Ω–∫–∞ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É
3. **PhotoCapture.takePhoto()** –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ `Dispatchers.IO`
4. **Camera2 API** –¥–µ–ª–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ —Ñ–æ—Ç–æ (1920x1080, JPEG 85%)
5. –§–æ—Ç–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ `NetworkClient.uploadPhoto()`
6. –õ–æ–∫–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª —É–¥–∞–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏

### –î–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

```kotlin
// app/src/main/java/ru/example/childwatch/photo/PhotoCapture.kt
class PhotoCapture(context: Context) {
    suspend fun takePhoto(): File? {
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
        if (!hasCameraPermission()) return null

        // –†–µ–∞–ª—å–Ω–∞—è —Å—ä—ë–º–∫–∞ —á–µ—Ä–µ–∑ Camera2
        return captureRealPhoto()
    }

    private fun captureRealPhoto(): File? {
        // 1. –°–æ–∑–¥–∞–Ω–∏–µ dummy SurfaceTexture (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è Camera2)
        // 2. ImageReader –¥–ª—è JPEG –∑–∞—Ö–≤–∞—Ç–∞
        // 3. CaptureSession —Å —Ç–∞–π–º–∞—É—Ç–æ–º 10 —Å–µ–∫
        // 4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
    }
}
```

## ‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Android

### Privacy Indicators (Android 12+)

| –í–µ—Ä—Å–∏—è        | –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä        | –û–ø–∏—Å–∞–Ω–∏–µ                            |
| ------------- | ---------------- | ----------------------------------- |
| Android 9-11  | –ù–µ—Ç              | –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ñ–æ–Ω–æ–≤–∞—è —Å—ä—ë–º–∫–∞            |
| Android 12-13 | üü¢ –ó–µ–ª—ë–Ω–∞—è —Ç–æ—á–∫–∞ | –ü–æ—è–≤–ª—è–µ—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å-–±–∞—Ä–µ –Ω–∞ 1-2 —Å–µ–∫ |
| Android 14+   | üü¢ + —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ | –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä + foreground notification |

**–û–±—Ö–æ–¥ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω** ‚Äî —Å–∏—Å—Ç–µ–º–Ω–æ–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

### –†–∞–∑—Ä–µ—à–µ–Ω–∏—è

```xml
<!-- AndroidManifest.xml -->
<uses-permission android:name="android.permission.CAMERA" />
<uses-permission android:name="android.permission.FOREGROUND_SERVICE_CAMERA" />

<service
    android:name=".service.MonitorService"
    android:foregroundServiceType="location|microphone|camera" />
```

## üì± –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### ADB –∫–æ–º–∞–Ω–¥–∞ (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

```bash
adb shell am start-foreground-service \
  -n ru.example.childwatch/.service.MonitorService \
  -a ru.example.childwatch.ACTION_TAKE_PHOTO
```

### –ß–µ—Ä–µ–∑ WebSocket (—Ä–æ–¥–∏—Ç–µ–ª—å ‚Üí —Ä–µ–±—ë–Ω–æ–∫)

```javascript
// –†–æ–¥–∏—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É
socket.emit("command", {
  deviceId: "child_device_id",
  action: "take_photo",
});

// –†–µ–±—ë–Ω–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç
socket.on("command", (data) => {
  if (data.action === "take_photo") {
    MonitorService.takePhoto();
  }
});
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

1. **–°–µ—Ä–≤–µ—Ä** –ø–æ–ª—É—á–∏—Ç —Ñ–æ—Ç–æ –Ω–∞ `/api/photo`
2. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** —Å–æ—Ö—Ä–∞–Ω–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ `photo_files`
3. **–§–∞–π–ª** —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ `server/uploads/photo_*.jpg`

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–æ—Ç–æ
ls -lh server/uploads/ | grep photo

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
tail -f server/logs/combined.log | grep PHOTO
```

## üîí –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –∞—Å–ø–µ–∫—Ç—ã

‚ö†Ô∏è **–í–ê–ñ–ù–û**: –°–∫—Ä—ã—Ç–∞—è —Ñ–æ—Ç–æ—Å—ä—ë–º–∫–∞ –Ω–µ—Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ–ª–µ—Ç–Ω–∏—Ö –º–æ–∂–µ—Ç –±—ã—Ç—å **–Ω–µ–∑–∞–∫–æ–Ω–Ω–æ–π** –≤ –≤–∞—à–µ–π —Å—Ç—Ä–∞–Ω–µ!

### –ó–∞–∫–æ–Ω–Ω–æ—Å—Ç—å –ø–æ —Å—Ç—Ä–∞–Ω–∞–º

- üá∑üá∫ **–†–æ—Å—Å–∏—è**: –†–∞–∑—Ä–µ—à–µ–Ω–æ —Å —Å–æ–≥–ª–∞—Å–∏—è —Ä–æ–¥–∏—Ç–µ–ª—è/–æ–ø–µ–∫—É–Ω–∞
- üá™üá∫ **EU (GDPR)**: –¢—Ä–µ–±—É–µ—Ç—Å—è —è–≤–Ω–æ–µ —Å–æ–≥–ª–∞—Å–∏–µ + purpose limitation
- üá∫üá∏ **USA**: –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —à—Ç–∞—Ç–∞ (California COPPA ‚Äî —Å—Ç—Ä–æ–≥–æ)
- üá¨üáß **UK**: –†–∞–∑—Ä–µ—à–µ–Ω–æ –¥–ª—è safety monitoring —Å —Å–æ–≥–ª–∞—Å–∏—è

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. ‚úÖ –£–≤–µ–¥–æ–º–∏—Ç–µ —Ä–µ–±—ë–Ω–∫–∞ –æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–µ
2. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
3. ‚úÖ –ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–æ—Ç–æ –¥–æ–ª—å—à–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ
4. ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥–ª—è –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö —Ü–µ–ª–µ–π

## üêõ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –§–æ—Ç–æ –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ MonitorService
adb logcat MonitorService:D PhotoCapture:D NetworkClient:D *:S

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
adb shell dumpsys package ru.example.childwatch | grep CAMERA

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞
adb shell ls -l /data/data/ru.example.childwatch/cache/photo_*.jpg
```

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

| –°–∏–º–ø—Ç–æ–º                   | –ü—Ä–∏—á–∏–Ω–∞               | –†–µ—à–µ–Ω–∏–µ                          |
| ------------------------- | --------------------- | -------------------------------- |
| –°–∏–Ω–∏–π –∫–≤–∞–¥—Ä–∞—Ç –≤–º–µ—Å—Ç–æ —Ñ–æ—Ç–æ | –°—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è APK     | –û–±–Ω–æ–≤–∏—Ç—å –¥–æ v7.1.0+              |
| SecurityException         | –ù–µ—Ç —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è CAMERA | –ó–∞–ø—Ä–æ—Å–∏—Ç—å –≤ PermissionHelper     |
| Timeout 10s               | –ö–∞–º–µ—Ä–∞ –∑–∞–Ω—è—Ç–∞         | –ó–∞–∫—Ä—ã—Ç—å –¥—Ä—É–≥–∏–µ –∫–∞–º–µ—Ä–∞-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è |
| –§–∞–π–ª 0 –±–∞–π—Ç               | CaptureSession failed | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å logcat –¥–ª—è onError     |

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- **–í—Ä–µ–º—è —Å—ä—ë–º–∫–∏**: 1-3 —Å–µ–∫—É–Ω–¥—ã
- **–†–∞–∑–º–µ—Ä —Ñ–æ—Ç–æ**: ~200-500 KB (JPEG 85%)
- **–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä**: 2-5 —Å–µ–∫—É–Ω–¥ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–µ—Ç–∏)
- **–ë–∞—Ç–∞—Ä–µ—è**: ~0.5% –Ω–∞ —Ñ–æ—Ç–æ (–Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ)

## üîÑ Changelog

- **v7.1.0** (2025-11-09): –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Camera2 API
- **v7.0.0** (2025-11-06): Placeholder –≤–µ—Ä—Å–∏—è (—Å–∏–Ω–∏–π –∫–≤–∞–¥—Ä–∞—Ç)

---

**–°–º. —Ç–∞–∫–∂–µ**:

- `ARCHITECTURE.md` ‚Äî –æ–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- `SERVER_SETUP.md` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
- `LEGAL.md` ‚Äî —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –∞—Å–ø–µ–∫—Ç—ã
