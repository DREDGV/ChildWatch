<!--
–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è AI-–∞–≥–µ–Ω—Ç–æ–≤: –∫—Ä–∞—Ç–∫–æ –∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –æ –ø—Ä–æ–µ–∫—Ç–µ ChildWatch.
–°–æ–∑–¥–∞–Ω—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, —Ä–∞–±–æ—á–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ —Ç–æ—á–µ–∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.
-->

# Copilot / AI instructions ‚Äî ChildWatch

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û - –ù–ï –ü–£–¢–ê–¢–¨ –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø:

### üì± **ChildWatch** (`app/` –º–æ–¥—É–ª—å) - –†–û–î–ò–¢–ï–õ–¨–°–ö–û–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–ï
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω –†–û–î–ò–¢–ï–õ–Ø
- **–§—É–Ω–∫—Ü–∏–∏:** –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–∫–∞—Ü–∏–∏ —Ä–µ–±–µ–Ω–∫–∞, —á–∞—Ç, –ø—Ä–æ—Å–ª—É—à–∫–∞, —É–¥–∞–ª–µ–Ω–Ω–∞—è –∫–∞–º–µ—Ä–∞, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- **–ü–∞–∫–µ—Ç:** `ru.example.childwatch`
- **–ü—É—Ç—å:** `app/src/main/java/ru/example/childwatch/`

### üë∂ **ParentWatch** (`parentwatch/` –º–æ–¥—É–ª—å) - –î–ï–¢–°–ö–û–ï –£–°–¢–†–û–ô–°–¢–í–û  
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω –†–ï–ë–ï–ù–ö–ê
- **–§—É–Ω–∫—Ü–∏–∏:** –û—Ç–ø—Ä–∞–≤–∫–∞ –ª–æ–∫–∞—Ü–∏–∏, –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥, –∑–∞–ø–∏—Å—å –∞—É–¥–∏–æ, —Å—ä–µ–º–∫–∞ —Ñ–æ—Ç–æ
- **–ü–∞–∫–µ—Ç:** `ru.example.parentwatch`
- **–ü—É—Ç—å:** `parentwatch/src/main/java/ru/example/parentwatch/`

**–ó–ê–ü–û–ú–ù–ò –ù–ê–í–°–ï–ì–î–ê:** –ù–∞–∑–≤–∞–Ω–∏—è –º–æ–¥—É–ª–µ–π –ü–ï–†–ï–ü–£–¢–ê–ù–´ —Å –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ–º!
- `app/` = ChildWatch = —Ç–µ–ª–µ—Ñ–æ–Ω –†–û–î–ò–¢–ï–õ–Ø = –ø—Ä–æ—Å–º–æ—Ç—Ä/–∫–æ–Ω—Ç—Ä–æ–ª—å
- `parentwatch/` = ParentWatch = —Ç–µ–ª–µ—Ñ–æ–Ω –†–ï–ë–ï–ù–ö–ê = –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥/–æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

---

–ö–æ—Ä–æ—Ç–∫–æ: ChildWatch (—Ä–æ–¥–∏—Ç–µ–ª—å) + ParentWatch (—Ä–µ–±–µ–Ω–æ–∫) + Node.js —Å–µ—Ä–≤–µ—Ä. –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞ –∏ –ø–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã –Ω–∏–∂–µ.

## –ë—ã—Å—Ç—Ä–∞—è –∫–∞—Ä—Ç–∞ –ø–æ –ø—Ä–æ–µ–∫—Ç—É

- **ChildWatch app (–†–û–î–ò–¢–ï–õ–¨):** `app/src/main/java/ru/example/childwatch/` ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –∫–∞—Ä—Ç—ã, —á–∞—Ç, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- **ParentWatch app (–†–ï–ë–ï–ù–û–ö):** `parentwatch/src/main/java/ru/example/parentwatch/` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö, foreground service
- **Server:** `server/` ‚Äî `index.js` (Express + Socket.IO), –º–∞—Ä—à—Ä—É—Ç—ã –≤ `server/routes/`, –º–µ–Ω–µ–¥–∂–µ—Ä—ã –≤ `server/managers/`, –±–∞–∑–∞ ‚Äî `server/database/` (sqlite3).

## –ß—Ç–æ –≤–∞–∂–Ω–æ –∑–Ω–∞—Ç—å (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ø–æ—Ç–æ–∫–∏)

- –ö–ª–∏–µ–Ω—Ç –¥–µ—Ä–∂–∏—Ç foreground —Å–µ—Ä–≤–∏—Å (`MonitorService`) ‚Äî –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª–æ–∫–∞—Ü–∏–∏ –∏ –ø–æ –∫–æ–º–∞–Ω–¥–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∞—É–¥–∏–æ.
- Endpoints —Å–µ—Ä–≤–µ—Ä–∞: `POST /api/loc`, `POST /api/audio`, `POST /api/photo`, `POST /api/auth/register`, `POST /api/auth/refresh`, `GET /api/location/latest` –∏ –¥—Ä. (—Å–º. `server/index.js`).
- –ê—É–¥–∏–æ/—Ñ–æ—Ç–æ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∫–∞–∫ multipart (Multer) –≤ `server/uploads/` –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ sqlite.
- WebSocket (Socket.IO) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–æ–º–∞–Ω–¥/—Å—Ç—Ä–∏–º–∏–Ω–≥–∞; –º–µ–Ω–µ–¥–∂–µ—Ä—ã –∫–æ–º–∞–Ω–¥ –∏ WS –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ `server/managers/`.

## Development setup (live preview + dual device)

- **Live preview:** scrcpy —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è real-time –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤.
- **Dual device workflow:** ParentWatch ‚Üí Nokia G21 (—Ä–µ–∞–ª—å–Ω—ã–π), ChildWatch ‚Üí Pixel 8 Emulator (–æ–±—Ö–æ–¥ Family Link).
- **Quick commands:** `.\scripts\dev-workflow.ps1 -Action setup|deploy|test|cleanup`
- **VS Code tasks:** 14 –∑–∞–¥–∞—á –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ (—Å–º. `.vscode/tasks.json`)
- **Documentation:** `.vscode/README.md` ‚Äî –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –≤—Å–µ–π dev –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

## –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã (–ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

- –°–±–æ—Ä–∫–∞ Android (–∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞):

```bash
./gradlew assembleDebug
adb install -r app/build/outputs/apk/debug/app-debug.apk
```

- –°–µ—Ä–≤–µ—Ä (–≤ `server/`):

```bash
cd server
npm install
npm start        # –∏–ª–∏ npm run dev –¥–ª—è nodemon
```

- –¢–µ—Å—Ç–æ–≤—ã–π —Ç—É–Ω–Ω–µ–ª—å: `ngrok http 3000` ‚Äî –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å HTTPS URL –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

## –ü–æ–ª–µ–∑–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –∫–æ–¥–∞

- –û—Ç–ø—Ä–∞–≤–∫–∞ –ª–æ–∫–∞—Ü–∏–∏: –∫–ª–∏–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç `/api/loc` —Å { latitude, longitude, accuracy, timestamp, deviceInfo } ‚Äî —Å–µ—Ä–≤–µ—Ä –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —á–µ—Ä–µ–∑ `DatabaseManager`.
- –ó–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ: `POST /api/audio` —Å –ø–æ–ª–µ–º `audio` (multipart). –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ ~10MB (—Å–º. multer –≤ `server/index.js`).
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞: `POST /api/auth/register` ‚Äî –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç deviceId, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç authToken/refreshToken.

## –ü—Ä–æ–µ–∫—Ç–Ω—ã–µ –∫–æ–Ω–≤–µ–Ω—Ü–∏–∏ –∏ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è

- minSdk=26, targetSdk=34 (Android) ‚Äî —Ñ–æ–Ω–æ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º –∫—Ä–∏—Ç–∏—á–Ω—ã.
- –§–∞–π–ª—ã –≤—Ä–µ–º–µ–Ω–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `server/uploads/` –∏ —É–¥–∞–ª—è—é—Ç—Å—è/–∞—Ä—Ö–∏–≤–∏—Ä—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ; –¥–ª—è production ‚Äî –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.
- HTTPS-only –¥–ª—è —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (README/ARCHITECTURE.md —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å).
- –õ–æ–≥–∏–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –≤ `server/auth/` –∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è middleware (`AuthMiddleware`).

## –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö (–ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏)

- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ API –æ–±–Ω–æ–≤–∏—Ç–µ `server/index.js` –∏ –º–∞—Ä—à—Ä—É—Ç—ã –≤ `server/routes/` –∏ –¥–æ–±–∞–≤—å—Ç–µ/–æ–±–Ω–æ–≤–∏—Ç–µ —Ç–µ—Å—Ç—ã (jest –≤ `server/package.json`).
- –î–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π background/foreground logic –Ω–∞ Android –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ Android 10+ –∏ Android 14 (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –º–∏–∫—Ä–æ—Ñ–æ–Ω–∞ –∏ background location).
- –ï—Å–ª–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç–µ –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ `multer` limits –∏ `maxHttpBufferSize` –≤ Socket.IO (—Å–º. `server/index.js`).

## –ì–¥–µ —Å–º–æ—Ç—Ä–µ—Ç—å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è

- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: `ARCHITECTURE.md`
- –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞: `DEVELOPMENT.md`
- –ì–ª–∞–≤–Ω—ã–π —Å–µ—Ä–≤–µ—Ä: `server/index.js`
- Android —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ —Å–µ—Ä–≤–∏—Å: `app/src/main/java/ru/example/childwatch/service/MonitorService.kt` –∏ `location/` `audio/` –ø–∞–ø–∫–∏.

---

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –≤–Ω–µ—Å—É –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ—Ä–æ—Ç–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, ¬´–∫–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å unit tests¬ª, ¬´–ø–æ–ª–µ–∑–Ω—ã–µ grep-–∑–∞–ø—Ä–æ—Å—ã¬ª –∏–ª–∏ –≥–æ—Ç–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API). –ù–∞–ø–∏—à–∏, —á—Ç–æ –¥–æ–±–∞–≤–∏—Ç—å.
