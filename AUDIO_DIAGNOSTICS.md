# üîç Audio Streaming Diagnostics

## –ü—Ä–æ–±–ª–µ–º–∞: –ó–≤—É–∫ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è –≤–æ–ª–Ω–∞–º–∏

–ó–≤—É–∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ ‚Üí —Ç–∏—à–∏–Ω–∞ ‚Üí —Å–Ω–æ–≤–∞ –∑–≤—É–∫ ‚Üí –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è.

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:

### 1. üî¥ ParentWatch –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å chunks
**–°–∏–º–ø—Ç–æ–º—ã:**
- –§—Ä–∞–≥–º–µ–Ω—Ç—ã –Ω–∞ ChildWatch —Ä–∞—Å—Ç—É—Ç –º–µ–¥–ª–µ–Ω–Ω–æ –∏–ª–∏ –Ω–µ—Ä–µ–≥—É–ª—è—Ä–Ω–æ
- –í –ª–æ–≥–∞—Ö ParentWatch: "No audio data recorded" –∏–ª–∏ "AudioRecord not initialized"

**–†–µ—à–µ–Ω–∏–µ:**
- –£–≤–µ–ª–∏—á–∏—Ç—å CHUNK_DURATION_MS —Å 2000 –¥–æ 3000-4000
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å MediaRecorder –≤–º–µ—Å—Ç–æ AudioRecord
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –ø–æ—Ç–æ–∫–∞ –∑–∞–ø–∏—Å–∏

### 2. üü° –°–µ—Ç–µ–≤—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ (Railway)
**–°–∏–º–ø—Ç–æ–º—ã:**
- –§—Ä–∞–≥–º–µ–Ω—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç —Å –±–æ–ª—å—à–∏–º–∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏
- –í –ª–æ–≥–∞—Ö: –¥–æ–ª–≥–æ–µ –≤—Ä–µ–º—è –º–µ–∂–¥—É "Uploading chunk" –∏ "Chunk uploaded"

**–†–µ—à–µ–Ω–∏–µ:**
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ (http://192.168.x.x:3000)
- –°–∂–∏–º–∞—Ç—å audio chunks (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Opus codec)
- Batch upload (–æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ chunks —Å—Ä–∞–∑—É)

### 3. üü° ChildWatch –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –±—ã—Å—Ç—Ä–µ–µ —á–µ–º –ø–æ–ª—É—á–∞–µ—Ç
**–°–∏–º–ø—Ç–æ–º—ã:**
- Queue size = 0 –ø–æ—Å—Ç–æ—è–Ω–Ω–æ
- –í –ª–æ–≥–∞—Ö: "Queue empty, waiting for chunks..."

**–†–µ—à–µ–Ω–∏–µ:**
- –£–≤–µ–ª–∏—á–∏—Ç—å MIN_BUFFER_CHUNKS —Å 3 –¥–æ 5-7
- –£–≤–µ–ª–∏—á–∏—Ç—å bufferSize AudioTrack
- –î–æ–±–∞–≤–∏—Ç—å adaptive buffering (dynamic MIN_BUFFER_CHUNKS)

### 4. üü¢ AudioTrack underrun (–±—É—Ñ–µ—Ä –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è)
**–°–∏–º–ø—Ç–æ–º—ã:**
- –í –ª–æ–≥–∞—Ö: "AudioTrack underrun" –∏–ª–∏ playState –º–µ–Ω—è–µ—Ç—Å—è
- –ó–≤—É–∫ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è –¥–∞–∂–µ –∫–æ–≥–¥–∞ queue –Ω–µ –ø—É—Å—Ç–∞—è

**–†–µ—à–µ–Ω–∏–µ:**
- –£–≤–µ–ª–∏—á–∏—Ç—å bufferSize AudioTrack —Å `bufferSize * 4` –¥–æ `bufferSize * 8`
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å AudioTrack.PERFORMANCE_MODE_LOW_LATENCY

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏ chunks (ParentWatch)

–ü–æ–¥–∫–ª—é—á–∏—Ç–µ ParentWatch —á–µ—Ä–µ–∑ USB –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ logcat:
```bash
adb logcat | grep -E "AudioStreamRecorder|Chunk.*uploaded"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
AudioStreamRecorder: Chunk 0 uploaded successfully (176400 bytes)
AudioStreamRecorder: Chunk 1 uploaded successfully (176400 bytes)
AudioStreamRecorder: Chunk 2 uploaded successfully (176400 bytes)
```

**–ò–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É chunks –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å ~2 —Å–µ–∫—É–Ω–¥—ã!**

–ï—Å–ª–∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª > 3 —Å–µ–∫—É–Ω–¥—ã ‚Üí ParentWatch –Ω–µ —É—Å–ø–µ–≤–∞–µ—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å!

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ (ChildWatch)

–ü–æ–¥–∫–ª—é—á–∏—Ç–µ ChildWatch —á–µ—Ä–µ–∑ USB –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ logcat:
```bash
adb logcat | grep -E "AudioStreamingActivity|queue size"
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
AudioStreamingActivity: Added 1 chunks to queue (total: 5, queue size: 3)
AudioStreamingActivity: Played chunk: 176400 bytes (queue size: 2)
AudioStreamingActivity: Added 1 chunks to queue (total: 6, queue size: 3)
```

**Queue size –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å >= 1 –ø–æ—Å—Ç–æ—è–Ω–Ω–æ!**

–ï—Å–ª–∏ queue size —á–∞—Å—Ç–æ = 0 ‚Üí Chunks –ø—Ä–∏—Ö–æ–¥—è—Ç –º–µ–¥–ª–µ–Ω–Ω–µ–µ —á–µ–º –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥—è—Ç—Å—è!

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ç–µ–≤—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏

–í –ª–æ–≥–∞—Ö ChildWatch –∏—â–∏—Ç–µ:
```bash
adb logcat | grep -E "NetworkClient|getAudioChunks"
```

–°–º–æ—Ç—Ä–∏—Ç–µ –≤—Ä–µ–º—è –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–æ–º –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ–º chunks.

**–ù–æ—Ä–º–∞–ª—å–Ω–æ:** < 500ms
**–ü–ª–æ—Ö–æ:** > 1000ms

## –ë—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã:

### –¢–µ—Å—Ç 1: –õ–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ü–ö: `npm run dev`
2. –ù–∞–π–¥–∏—Ç–µ IP –∞–¥—Ä–µ—Å –ü–ö –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏: `ipconfig` (Windows) –∏–ª–∏ `ifconfig` (Mac/Linux)
3. –í ParentWatch –∏ ChildWatch —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Server URL: `http://192.168.X.X:3000`
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ—Å–ª—É—à–∫—É

**–ï—Å–ª–∏ –∑–≤—É–∫ —Å—Ç–∞–ª –ª—É—á—à–µ** ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ –≤ Railway (—Å–µ—Ç–µ–≤—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏)
**–ï—Å–ª–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π** ‚Üí –ø—Ä–æ–±–ª–µ–º–∞ –≤ –∑–∞–ø–∏—Å–∏/–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–∏

### –¢–µ—Å—Ç 2: –£–≤–µ–ª–∏—á–∏—Ç—å –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—é
–í—Ä–µ–º–µ–Ω–Ω–æ –∏–∑–º–µ–Ω–∏—Ç–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ –∫–æ–¥–µ:

**ChildWatch (AudioStreamingActivity.kt):**
```kotlin
private const val MIN_BUFFER_CHUNKS = 7  // –±—ã–ª–æ 3
```

**ParentWatch (AudioStreamRecorder.kt):**
```kotlin
private const val CHUNK_DURATION_MS = 3000L  // –±—ã–ª–æ 2000L
```

–ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ.

**–ï—Å–ª–∏ –∑–≤—É–∫ —Å—Ç–∞–ª –ª—É—á—à–µ** ‚Üí –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏!

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã:

### –ü–æ–¥—Ö–æ–¥ 1: WebRTC (real-time streaming)
**–ü–ª—é—Å—ã:**
- –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è real-time audio
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è –∫ —Å–µ—Ç–µ–≤—ã–º —É—Å–ª–æ–≤–∏—è–º
- –í—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ —à—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ

**–ú–∏–Ω—É—Å—ã:**
- –°–ª–æ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- –¢—Ä–µ–±—É–µ—Ç WebRTC —Å–µ—Ä–≤–µ—Ä (–Ω–µ Node.js REST API)

### –ü–æ–¥—Ö–æ–¥ 2: WebSocket streaming
**–ü–ª—é—Å—ã:**
- –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (–Ω–µ—Ç overhead –æ—Ç HTTP requests)
- Push –º–æ–¥–µ–ª—å (—Å–µ—Ä–≤–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç chunks —Å—Ä–∞–∑—É)
- –ú–µ–Ω—å—à–µ –∑–∞–¥–µ—Ä–∂–∫–∏

**–ú–∏–Ω—É—Å—ã:**
- –ù—É–∂–Ω–æ –ø–µ—Ä–µ–¥–µ–ª–∞—Ç—å —Å–µ—Ä–≤–µ—Ä –Ω–∞ WebSocket
- –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞

### –ü–æ–¥—Ö–æ–¥ 3: Opus codec —Å –∫–æ–º–ø—Ä–µ—Å—Å–∏–µ–π
**–ü–ª—é—Å—ã:**
- –ú–µ–Ω—å—à–∏–π —Ä–∞–∑–º–µ—Ä chunks (50-60% —ç–∫–æ–Ω–æ–º–∏—è)
- –ë—ã—Å—Ç—Ä–µ–µ –ø–µ—Ä–µ–¥–∞—á–∞ –ø–æ —Å–µ—Ç–∏
- –õ—É—á—à–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø—Ä–∏ —Ç–æ–º –∂–µ bitrate

**–ú–∏–Ω—É—Å—ã:**
- –ù—É–∂–µ–Ω encoder/decoder (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ Opus)
- –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –Ω–∞ encoding/decoding

### –ü–æ–¥—Ö–æ–¥ 4: Adaptive Bitrate
**–ü–ª—é—Å—ã:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–Ω–∏–∂–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –ø—Ä–∏ –ø–ª–æ—Ö–æ–π —Å–µ—Ç–∏
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –º–µ–Ω—è–µ—Ç CHUNK_DURATION_MS

**–ú–∏–Ω—É—Å—ã:**
- –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏
- –ü–µ—Ä–µ–º–µ–Ω–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∑–≤—É–∫–∞

## –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ:

**–≠—Ç–∞–ø 1 (–±—ã—Å—Ç—Ä–æ):**
1. –£–≤–µ–ª–∏—á–∏—Ç—å MIN_BUFFER_CHUNKS –¥–æ 7
2. –£–≤–µ–ª–∏—á–∏—Ç—å AudioTrack buffer –¥–æ `bufferSize * 8`
3. –£–≤–µ–ª–∏—á–∏—Ç—å CHUNK_DURATION_MS –¥–æ 3000ms

**–≠—Ç–∞–ø 2 (–µ—Å–ª–∏ –Ω–µ –ø–æ–º–æ–≥–ª–æ):**
1. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ WebSocket streaming
2. –î–æ–±–∞–≤–∏—Ç—å adaptive buffering

**–≠—Ç–∞–ø 3 (–¥–ª—è –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞):**
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Opus codec
2. WebRTC –¥–ª—è ultra-low latency

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. **–°–ù–ê–ß–ê–õ–ê**: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É (logcat) —á—Ç–æ–±—ã –ø–æ–Ω—è—Ç—å –≥–¥–µ bottleneck
2. **–ü–û–¢–û–ú**: –ü—Ä–∏–º–µ–Ω–∏—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Ä–µ—à–µ–Ω–∏–µ
3. **–ù–ê–ö–û–ù–ï–¶**: –ï—Å–ª–∏ –ø—Ä–æ—Å—Ç—ã–µ —Ä–µ—à–µ–Ω–∏—è –Ω–µ –ø–æ–º–æ–≥–∞—é—Ç ‚Üí WebSocket/WebRTC
