# WebSocket Migration Plan - –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è –ü—Ä–æ—Å–ª—É—à–∫–∞

## üéØ –¶–µ–ª—å
–ó–∞–º–µ–Ω–∏—Ç—å HTTP polling –Ω–∞ WebSocket –¥–ª—è **–Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–π** –ø–µ—Ä–µ–¥–∞—á–∏ –∞—É–¥–∏–æ –±–µ–∑ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π.

## üìã –¢–µ–∫—É—â–∞—è –ü—Ä–æ–±–ª–µ–º–∞
- HTTP polling —Å–æ–∑–¥–∞–µ—Ç –∑–∞–¥–µ—Ä–∂–∫–∏ 1.5-2 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
- –ó–∞–ø–∏—Å—å –∏ –æ–ø—Ä–æ—Å –Ω–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã ‚Üí –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ "–¥—ã—Ä—ã" –≤ –¥–∞–Ω–Ω—ã—Ö
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å real-time –ø–æ—Ç–æ–∫ —Å HTTP
- –†–µ–∑—É–ª—å—Ç–∞—Ç: –∑–≤—É–∫ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è –≤–æ–ª–Ω–∞–º–∏, –¥–∞–∂–µ —Å –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–µ–π

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: WebSocket Architecture

```
ParentWatch (child phone)
    ‚Üì –∑–∞–ø–∏—Å—å PCM –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫
    ‚Üì WebSocket.send(chunk) ‚Üê –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
    ‚Üì
Server (Node.js + Socket.IO)
    ‚Üì –ø–æ–ª—É—á–∞–µ—Ç chunk
    ‚Üì WebSocket.emit(chunk) ‚Üí –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
    ‚Üì
ChildWatch (parent phone)
    ‚Üì WebSocket.on('chunk') ‚Üê –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ
    ‚Üì –¥–æ–±–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å
    ‚Üì AudioTrack.write() ‚Üê –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
```

---

## üìù –ü–ª–∞–Ω –î–µ–π—Å—Ç–≤–∏–π (–ü–æ—à–∞–≥–æ–≤—ã–π)

### ‚úÖ –§–∞–∑–∞ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –°–µ—Ä–≤–µ—Ä–∞ (30 –º–∏–Ω—É—Ç)

#### –®–∞–≥ 1.1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Socket.IO –Ω–∞ —Å–µ—Ä–≤–µ—Ä
```bash
cd server
npm install socket.io@4
```

#### –®–∞–≥ 1.2: –°–æ–∑–¥–∞—Ç—å WebSocket Manager
**–§–∞–π–ª:** `server/managers/WebSocketManager.js`

**–§—É–Ω–∫—Ü–∏–∏:**
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤
- –†–æ—É—Ç–∏–Ω–≥ —á–∞–Ω–∫–æ–≤: `child-XXXX` ‚Üí `parent`
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–Ω–∞—Ç–∞–º–∏ (rooms) –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ —Å–µ—Å—Å–∏–π
- Heartbeat –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

#### –®–∞–≥ 1.3: –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å Socket.IO –≤ —Å–µ—Ä–≤–µ—Ä
**–§–∞–π–ª:** `server/index.js`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å Socket.IO –∫ Express
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CORS –¥–ª—è WebSocket
- –ü–æ–¥–∫–ª—é—á–∏—Ç—å WebSocketManager

#### –®–∞–≥ 1.4: –û–±–Ω–æ–≤–∏—Ç—å API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
**–§–∞–π–ª:** `server/routes/streaming.js`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- `/api/streaming/start` ‚Üí —Å–æ–∑–¥–∞–µ—Ç WebSocket –∫–æ–º–Ω–∞—Ç—É
- `/api/streaming/stop` ‚Üí –∑–∞–∫—Ä—ã–≤–∞–µ—Ç WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
- –£–±—Ä–∞—Ç—å `/api/streaming/chunks` (–±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–µ–Ω HTTP polling)

---

### ‚úÖ –§–∞–∑–∞ 2: ParentWatch (Child Device) - –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ WebSocket (45 –º–∏–Ω—É—Ç)

#### –®–∞–≥ 2.1: –î–æ–±–∞–≤–∏—Ç—å Socket.IO –∫–ª–∏–µ–Ω—Ç –≤ Android
**–§–∞–π–ª:** `parentwatch/build.gradle`

```gradle
dependencies {
    implementation 'io.socket:socket.io-client:2.1.0'
}
```

#### –®–∞–≥ 2.2: –°–æ–∑–¥–∞—Ç—å WebSocketClient –¥–ª—è ParentWatch
**–ù–æ–≤—ã–π —Ñ–∞–π–ª:** `parentwatch/src/main/java/ru/example/parentwatch/network/WebSocketClient.kt`

**–§—É–Ω–∫—Ü–∏–∏:**
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É —á–µ—Ä–µ–∑ Socket.IO
- –û—Ç–ø—Ä–∞–≤–∫–∞ –∞—É–¥–∏–æ —á–∞–Ω–∫–æ–≤: `socket.emit("audio_chunk", data)`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- Heartbeat –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

#### –®–∞–≥ 2.3: –ò–∑–º–µ–Ω–∏—Ç—å AudioStreamRecorder
**–§–∞–π–ª:** `parentwatch/src/main/java/ru/example/parentwatch/audio/AudioStreamRecorder.kt`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –£–±—Ä–∞—Ç—å HTTP POST –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —á–∞–Ω–∫–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `WebSocketClient.sendAudioChunk()`
- –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏ (–±–µ–∑ delay)

#### –®–∞–≥ 2.4: –û–±–Ω–æ–≤–∏—Ç—å LocationService
**–§–∞–π–ª:** `parentwatch/src/main/java/ru/example/parentwatch/service/LocationService.kt`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è WebSocketClient –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞
- –ó–∞–∫—Ä—ã—Ç–∏–µ WebSocket –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ

---

### ‚úÖ –§–∞–∑–∞ 3: ChildWatch (Parent Device) - –ü–æ–ª—É—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ WebSocket (45 –º–∏–Ω—É—Ç)

#### –®–∞–≥ 3.1: –î–æ–±–∞–≤–∏—Ç—å Socket.IO –∫–ª–∏–µ–Ω—Ç –≤ Android
**–§–∞–π–ª:** `app/build.gradle`

```gradle
dependencies {
    implementation 'io.socket:socket.io-client:2.1.0'
}
```

#### –®–∞–≥ 3.2: –°–æ–∑–¥–∞—Ç—å WebSocketClient –¥–ª—è ChildWatch
**–ù–æ–≤—ã–π —Ñ–∞–π–ª:** `app/src/main/java/ru/example/childwatch/network/WebSocketClient.kt`

**–§—É–Ω–∫—Ü–∏–∏:**
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
- –ü—Ä–∏–µ–º –∞—É–¥–∏–æ —á–∞–Ω–∫–æ–≤: `socket.on("audio_chunk") { data -> ... }`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ–±—Ä—ã–≤–µ
- Heartbeat

#### –®–∞–≥ 3.3: –ò–∑–º–µ–Ω–∏—Ç—å AudioStreamingActivity
**–§–∞–π–ª:** `app/src/main/java/ru/example/childwatch/AudioStreamingActivity.kt`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –£–±—Ä–∞—Ç—å HTTP polling loop (updateJob)
- –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ WebSocket –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- –ü–æ–ª—É—á–∞—Ç—å —á–∞–Ω–∫–∏ —á–µ—Ä–µ–∑ WebSocket callback ‚Üí –¥–æ–±–∞–≤–ª—è—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å
- Playback job –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (–≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –∏–∑ –æ—á–µ—Ä–µ–¥–∏)

#### –®–∞–≥ 3.4: –£–ª—É—á—à–∏—Ç—å –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—é
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `MIN_BUFFER_CHUNKS = 3` (–º–µ–Ω—å—à–µ –∑–∞–¥–µ—Ä–∂–∫–∞, —Ç.–∫. WebSocket –±—ã—Å—Ç—Ä–µ–µ)
- `MAX_BUFFER_CHUNKS = 10` (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –Ω–∞–∫–æ–ø–ª–µ–Ω–∏—è)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö —á–∞–Ω–∫–æ–≤

---

### ‚úÖ –§–∞–∑–∞ 4: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (30 –º–∏–Ω—É—Ç)

#### –®–∞–≥ 4.1: –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä –ª–æ–∫–∞–ª—å–Ω–æ: `cd server && npm run dev`
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–±–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ `http://10.0.2.2:3000`
3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–∞ —ç–º—É–ª—è—Ç–æ—Ä–∞—Ö
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
   - ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ WebSocket (–ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞)
   - ‚úÖ –ü–µ—Ä–µ–¥–∞—á–∞ —á–∞–Ω–∫–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
   - ‚úÖ –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –±–µ–∑ –ø–∞—É–∑

#### –®–∞–≥ 4.2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
1. –ó–∞–¥–µ–ø–ª–æ–∏—Ç—å –Ω–∞ Railway (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ push)
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–±–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ Railway URL
3. –¢–µ—Å—Ç –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö WiFi
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ —Å–ª–∞–±–æ–º —Å–∏–≥–Ω–∞–ª–µ

#### –®–∞–≥ 4.3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
1. –û—Ç–∫–ª—é—á–∏—Ç—å WiFi –Ω–∞ child device ‚Üí –ø–æ–¥–æ–∂–¥–∞—Ç—å 5 —Å–µ–∫ ‚Üí –≤–∫–ª—é—á–∏—Ç—å
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞
3. –õ–æ–≥–∏ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑–∞—Ç—å: `WebSocket reconnected`

---

### ‚úÖ –§–∞–∑–∞ 5: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, 1-2 —á–∞—Å–∞)

#### –®–∞–≥ 5.1: –£–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä —á–∞–Ω–∫–æ–≤ (Opus codec)
**–ó–∞—á–µ–º:** 264 KB ‚Üí ~9 KB (30x –º–µ–Ω—å—à–µ) ‚Üí –±—ã—Å—Ç—Ä–µ–µ –ø–µ—Ä–µ–¥–∞—á–∞

**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞:** `com.github.theeasiestway:opus:1.0.2`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ParentWatch: PCM ‚Üí Opus –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- ChildWatch: Opus ‚Üí PCM –ø–µ—Ä–µ–¥ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –ï—â–µ –±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Å—Ç—Ä–∏–º–∏–Ω–≥, –º–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ç—å

#### –®–∞–≥ 5.2: –î–æ–±–∞–≤–∏—Ç—å —Å–∂–∞—Ç–∏–µ WebSocket
**Server config:**
```javascript
io.use(compression())
```

#### –®–∞–≥ 5.3: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–∞—á–µ—Å—Ç–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å ping/latency –≤ UI
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∫–∞—á–µ—Å—Ç–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (–∑–µ–ª–µ–Ω—ã–π/–∂–µ–ª—Ç—ã–π/–∫—Ä–∞—Å–Ω—ã–π)

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –î–µ—Ç–∞–ª–∏

### WebSocket Events (Server ‚Üî Clients)

#### ParentWatch ‚Üí Server:
- `connect` - –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ child device
- `audio_chunk` - –æ—Ç–ø—Ä–∞–≤–∫–∞ PCM –¥–∞–Ω–Ω—ã—Ö
- `heartbeat` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

#### Server ‚Üí ChildWatch:
- `audio_chunk` - –¥–æ—Å—Ç–∞–≤–∫–∞ PCM –¥–∞–Ω–Ω—ã—Ö
- `streaming_started` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –Ω–∞—á–∞–ª–µ
- `streaming_stopped` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ—Å—Ç–∞–Ω–æ–≤–∫–µ

#### Bi-directional:
- `ping/pong` - –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- `error` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### Socket.IO Configuration

```javascript
// Server
const io = require('socket.io')(server, {
    cors: {
        origin: "*",
        methods: ["GET", "POST"]
    },
    pingTimeout: 60000,
    pingInterval: 25000,
    transports: ['websocket', 'polling'] // fallback to polling if needed
});

// Android Client
val opts = IO.Options().apply {
    transports = arrayOf("websocket")
    reconnection = true
    reconnectionAttempts = Int.MAX_VALUE
    reconnectionDelay = 1000
    timeout = 20000
}
```

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –§–∞–π–ª–æ–≤ (–ü–æ—Å–ª–µ –ú–∏–≥—Ä–∞—Ü–∏–∏)

### Server (Node.js)
```
server/
‚îú‚îÄ‚îÄ managers/
‚îÇ   ‚îú‚îÄ‚îÄ CommandManager.js (existing - keep for commands)
‚îÇ   ‚îî‚îÄ‚îÄ WebSocketManager.js (NEW - WebSocket logic)
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îî‚îÄ‚îÄ streaming.js (modified - WebSocket setup endpoints)
‚îú‚îÄ‚îÄ index.js (modified - integrate Socket.IO)
‚îî‚îÄ‚îÄ package.json (add socket.io dependency)
```

### ParentWatch (Child Device)
```
parentwatch/src/main/java/ru/example/parentwatch/
‚îú‚îÄ‚îÄ network/
‚îÇ   ‚îú‚îÄ‚îÄ NetworkHelper.kt (existing - keep for HTTP)
‚îÇ   ‚îî‚îÄ‚îÄ WebSocketClient.kt (NEW - WebSocket audio upload)
‚îú‚îÄ‚îÄ audio/
‚îÇ   ‚îî‚îÄ‚îÄ AudioStreamRecorder.kt (modified - use WebSocket)
‚îî‚îÄ‚îÄ service/
    ‚îî‚îÄ‚îÄ LocationService.kt (modified - manage WebSocket lifecycle)
```

### ChildWatch (Parent Device)
```
app/src/main/java/ru/example/childwatch/
‚îú‚îÄ‚îÄ network/
‚îÇ   ‚îú‚îÄ‚îÄ NetworkClient.kt (existing - keep for HTTP commands)
‚îÇ   ‚îî‚îÄ‚îÄ WebSocketClient.kt (NEW - WebSocket audio download)
‚îî‚îÄ‚îÄ AudioStreamingActivity.kt (modified - receive from WebSocket)
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ú–æ–º–µ–Ω—Ç—ã

### 1. –û–±—Ä–∞—Ç–Ω–∞—è –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
- HTTP API –¥–ª—è –∫–æ–º–∞–Ω–¥ (start/stop) **–æ—Å—Ç–∞–µ—Ç—Å—è**
- –¢–æ–ª—å–∫–æ –∞—É–¥–∏–æ —á–∞–Ω–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥—è—Ç –Ω–∞ WebSocket
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –û—à–∏–±–æ–∫
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ–±—Ä—ã–≤–µ —Å–≤—è–∑–∏
- –û—á–∏—Å—Ç–∫–∞ –±—É—Ñ–µ—Ä–∞ –ø—Ä–∏ –¥–æ–ª–≥–æ–π –ø–æ—Ç–µ—Ä–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (>30 —Å–µ–∫)
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

### 3. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- Socket.IO –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ç–µ –∂–µ —Ç–æ–∫–µ–Ω—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ Device ID –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
- –ò–∑–æ–ª—è—Ü–∏—è —Å–µ—Å—Å–∏–π —á–µ—Ä–µ–∑ –∫–æ–º–Ω–∞—Ç—ã (rooms)

### 4. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- WebSocket –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–¥–Ω–æ TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (vs HTTP –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ)
- –ú–µ–Ω—å—à–µ overhead (–Ω–µ—Ç HTTP headers –∫–∞–∂–¥—ã–π —Ä–∞–∑)
- Binary mode –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∞—É–¥–∏–æ (–Ω–µ JSON)

---

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ (HTTP Polling):
- ‚ùå –ó–∞–¥–µ—Ä–∂–∫–∞: 1.5-2 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏
- ‚ùå –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏—è: –∑–≤—É–∫ –≤–æ–ª–Ω–∞–º–∏ (2-5 —Å–µ–∫ –∑–≤—É–∫, 2-3 —Å–µ–∫ —Ç–∏—à–∏–Ω–∞)
- ‚ùå –ù–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: –∑–∞–ø–∏—Å—å –∏ –æ–ø—Ä–æ—Å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã
- ‚ùå –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞: –º–Ω–æ–≥–æ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤

### –ü–æ—Å–ª–µ (WebSocket):
- ‚úÖ –ó–∞–¥–µ—Ä–∂–∫–∞: < 100 –º—Å (–ø–æ—á—Ç–∏ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ)
- ‚úÖ –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–π –∑–≤—É–∫: –±–µ–∑ –ø–∞—É–∑ –∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ: push –ø—Ä–∏ –∑–∞–ø–∏—Å–∏ ‚Üí instant delivery
- ‚úÖ –ù–∏–∑–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞: –æ–¥–Ω–æ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

---

## üöÄ –ü–æ—Ä—è–¥–æ–∫ –í—ã–ø–æ–ª–Ω–µ–Ω–∏—è

1. **–°–Ω–∞—á–∞–ª–∞:** –§–∞–∑–∞ 1 (Server) - –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É
2. **–ü–æ—Ç–æ–º:** –§–∞–∑–∞ 2 (ParentWatch) - –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ WebSocket
3. **–ü–æ—Ç–æ–º:** –§–∞–∑–∞ 3 (ChildWatch) - –ø–æ–ª—É—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ WebSocket
4. **–ü–æ—Ç–æ–º:** –§–∞–∑–∞ 4 (Testing) - –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ —ç–º—É–ª—è—Ç–æ—Ä–∞—Ö –∏ —Ä–µ–∞–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
5. **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:** –§–∞–∑–∞ 5 (Opus) - –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

---

## üîç –ö–∞–∫ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –£—Å–ø–µ—Ö?

### –õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:
```
üîå Child device child-XXXX connected via WebSocket
üéôÔ∏è Receiving audio chunks from child-XXXX (2 chunks/sec)
üì§ Broadcasting to parent device
```

### –õ–æ–≥–∏ ChildWatch –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:
```
üîå WebSocket connected to server
üéß Receiving audio chunk (sequence: 0, size: 264600)
üéß Receiving audio chunk (sequence: 1, size: 264600)
‚ñ∂Ô∏è Playing chunk from queue (queue size: 5)
```

### –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞:
- ‚úÖ –§—Ä–∞–≥–º–µ–Ω—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ (–±–µ–∑ –ø—Ä–æ–ø—É—Å–∫–æ–≤)
- ‚úÖ –û—á–µ—Ä–µ–¥—å —Å—Ç–∞–±–∏–ª—å–Ω–∞ (3-7 —á–∞–Ω–∫–æ–≤)
- ‚úÖ –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –±–µ–∑ –ø–∞—É–∑ >500ms
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –ø–æ–≤–æ—Ä–æ—Ç–µ —ç–∫—Ä–∞–Ω–∞
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ WiFi

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ –°—Å—ã–ª–∫–∏

- Socket.IO Android Client: https://socket.io/docs/v4/client-installation/
- Socket.IO Server (Node.js): https://socket.io/docs/v4/server-api/
- Binary data with Socket.IO: https://socket.io/docs/v4/emitting-events/#binary
- Opus Codec for Android: https://github.com/theeasiestway/android-opus-codec

---

## ‚è±Ô∏è –û–±—â–µ–µ –í—Ä–µ–º—è: ~2.5 —á–∞—Å–∞

- –§–∞–∑–∞ 1: 30 –º–∏–Ω—É—Ç (Server)
- –§–∞–∑–∞ 2: 45 –º–∏–Ω—É—Ç (ParentWatch)
- –§–∞–∑–∞ 3: 45 –º–∏–Ω—É—Ç (ChildWatch)
- –§–∞–∑–∞ 4: 30 –º–∏–Ω—É—Ç (Testing)
- **–ò—Ç–æ–≥–æ:** 2.5 —á–∞—Å–∞ –¥–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–µ–≥–æ —Ä–µ—à–µ–Ω–∏—è

–§–∞–∑–∞ 5 (Opus) - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, +1-2 —á–∞—Å–∞ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ.

---

**–ì–æ—Ç–æ–≤–æ! –≠—Ç–æ—Ç –ø–ª–∞–Ω —Ä–µ—à–∏—Ç –ø—Ä–æ–±–ª–µ–º—É –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –∏ –¥–∞—Å—Ç –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—É—é –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—É—é –ø—Ä–æ—Å–ª—É—à–∫—É.**
